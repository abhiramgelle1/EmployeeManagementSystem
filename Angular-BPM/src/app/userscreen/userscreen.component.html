<!-- <div class="row h-100 align-items-center justify-content-center" style="background-color: rgb(180, 180, 180);">
<span style="font-size: 80px; color: rgb(100, 100, 100);">User Dashboard</span>
</div> -->
<div class="back" style="background-color: #f0f2f5; height: 100vh;">
  <div class="container-fluid">
    <div class="row">
      <nav class="navbar offset-md-3 offset-lg-2 col-md-9 col-lg-10 sticky-top flex-md-nowrap p-0 nav-1">
        <span class="navbar-brand col-md-3 col-lg-2 mr-0 mt-2 px-3" href="#" style="margin-left: 10px;"><img
            src="assets/Images/eaiesb_logo.png" style="width: 80px;" />
        </span>
        <ul class="navbar-nav px-3">
          <li class="nav-item text-nowrap">
            <button type="button" class="btn btn-outline-danger btn-3" (click)="signOut()">
              Sign Out
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>
  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse">
        <div class="card card-1">
          <div class="card-body card-body-1 text-center align-items-center justify-content-center">
            <div class="imgcontainer" style="box-shadow: 0px 0px 16px rgba(0, 0, 0, 0.2);">
              <img class="image" [src]="displayPicture" class="card-img-top text-center" alt="..." />
            </div>
            <span class="card-title" style="
                margin-top: 20px;
                font-weight: bold;
                display: block;
                color: rgba(255, 255, 255, 0.72);
              ">{{ firstName }} {{ lastName }}</span>
          </div>
        </div>
        <div class="sidebar-sticky">
          <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab"
              aria-controls="v-pills-home" aria-selected="true"><span data-feather="briefcase"
                style="width: 16px; height: 16px; margin-right: 6px;"></span>Tasks<span
                class="sr-only">(current)</span></a>
            <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab"
              aria-controls="v-pills-profile" aria-selected="false"><span data-feather="file-text"
                style="width: 16px; height: 16px; margin-right: 6px;"></span>Reports</a>
            <a class="nav-link" id="v-pills-messages-tab" data-toggle="pill" href="#v-pills-messages" role="tab"
              aria-controls="v-pills-messages" aria-selected="false"><span data-feather="user"
                style="width: 16px; height: 16px; margin-right: 6px;"></span>Users</a>
            <a class="nav-link" id="v-pills-settings-tab" data-toggle="pill" href="#v-pills-settings" role="tab"
              aria-controls="v-pills-settings" aria-selected="false"><span data-feather="users"
                style="width: 16px; height: 16px; margin-right: 6px;"></span>Groups</a>
          </div>
          <!-- <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
          <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-home" role="tab" aria-controls="v-pills-home" aria-selected="true">Tasks</a>
          <a class="nav-link" id="v-pills-profile-tab" data-toggle="pill" href="#v-pills-profile" role="tab" aria-controls="v-pills-profile" aria-selected="false">Reports</a>
          <a class="nav-link" id="v-pills-messages-tab" data-toggle="pill" href="#v-pills-messages" role="tab" aria-controls="v-pills-messages" aria-selected="false">Users</a>
        </div> -->
        </div>
      </nav>
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4"
        style=" height:694px ;box-shadow: -2px -2px 16px rgba(0, 0, 0, 0.2);">
        <div class="tab-content" id="v-pills-tabContent">
          <div class="tab-pane fade  show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab">
            <div
              class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
              style="min-height: 72px;">
              <h1 class="h2">Tasks</h1>
              <div class="btn-toolbar mb-2 mb-md-0">
                <button type="button" class="btn btn-outline-secondary btn-1" style="margin-right: 10px;" (click)="reloadTasks()">
                  Refresh
                </button>
                <button type="button" class="btn btn-outline-secondary btn-1" data-toggle="modal"
                  data-target="#add_new_task">
                  New Task
                </button>
              </div>
            </div>
            <div class="modal fade" id="add_new_task" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Add new task
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <!-- <form [formGroup] = "uploadForm" (ngSubmit)="onSubmit()" id="task-form"> -->
                      <form>
                      <div class="form-group">
                        <input type="text" class="input form-control" placeholder="Task Title" id="lnameInput"
                          (input)="taskTitle = $event.target.value" />
                      </div>
                      <div class="form-group">
                        <textarea class="form-control" rows="4" id="comment" placeholder="Task Description"
                          (input)="taskDescription = $event.target.value"></textarea>
                      </div>
                      <div class="form-row">
                        <div class="form-group col-md-4">
                          <input type="text" class="input form-control" placeholder="Assigned Type" id="fnameInput"
                            (input)="assignedType = $event.target.value" />
                        </div>
                        <div class="form-group col-md-8">
                          <input type="text" class="input form-control" placeholder="Assigned To" id="lnameInput"
                            (input)="assignedTo = $event.target.value" />
                        </div>
                      </div>
                      <!-- <div class="form-group">
                            <input type="file" name="profile" (change)="onFileSelect($event)" />
                      </div> -->
                      <span *ngIf="taskmessage">
                        {{ taskmessage }}
                      </span>
                    </form>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-danger" style="border-radius: 20px;"
                      data-dismiss="modal">
                      Close
                    </button>
                    <!-- <button type="submit" class="btn btn-outline-primary" style="border-radius: 20px;" form="task-form"
                      (click)="postTaskDetails()">
                      Create Task
                    </button> -->
                    <button type="button" class="btn btn-outline-primary" style="border-radius: 20px;"
                      (click)="postTaskDetails()">
                      Create Task
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="taskboard">
              <div class="taskboard-card">
                <div class="taskboard-head text-uppercase">Pending</div>
                <span *ngFor="let task of myTasks">
                  <div class="taskboard-task" *ngIf="task.status != 'started'" data-toggle="modal"
                    data-target="#view_task" (click)="getTask(task._id)">
                    <div class="taskboard-task-title">{{ task.taskTitle }}</div>
                    <div class="taskboard-task-description">
                      {{ task.taskDescription }}
                    </div>
                    <div class="taskboard-task-created">
                      {{ task.createdBy }}
                    </div>
                  </div>
                </span>
              </div>
              <div class="taskboard-card">
                <div class="taskboard-head text-uppercase">to-do</div>
                <span *ngFor="let task of myTasks">
                  <div class="taskboard-task" *ngIf="task.status == 'started'" data-toggle="modal"
                    data-target="#view_task" (click)="getTask(task._id)">
                    <div class="taskboard-task-title">{{ task.taskTitle }}</div>
                    <div class="taskboard-task-description">
                      {{ task.taskDescription }}
                    </div>
                    <div class="taskboard-task-created">
                      {{ task.createdBy }}
                    </div>
                  </div>
                </span>
              </div>
              <div class="taskboard-card">
                <div class="taskboard-head text-uppercase">group tasks</div>
                <span *ngFor="let task of myGroupTasks">
                  <div class="taskboard-task" data-toggle="modal" data-target="#view_task" (click)="getTask(task._id)">
                    <div class="taskboard-task-title">{{ task.taskTitle }}</div>
                    <div class="taskboard-task-description">
                      {{ task.taskDescription }}
                    </div>
                    <div class="taskboard-task-created">
                      {{ task.createdBy }}
                    </div>
                  </div>
                </span>
              </div>
              <div class="taskboard-card">
                <div class="taskboard-head text-uppercase">reportees tasks</div>
                <span *ngFor="let task of myReporteesTasks">
                  <div class="taskboard-task" data-toggle="modal" data-target="#view_task" (click)="getTask(task._id)">
                    <div class="taskboard-task-title">{{ task.taskTitle }}</div>
                    <div class="taskboard-task-description">
                      {{ task.taskDescription }}
                    </div>
                    <div class="taskboard-task-created">
                      {{ task.createdBy }}
                    </div>
                  </div>
                </span>
              </div>
            </div>
            <div class="modal fade" id="view_task" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document" style="max-width: 900px;">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      View task
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" *ngIf="viewTask">
                    <div class="d-flex justify-content-between">
                      <div style="max-width: 500px;">
                        <form>
                          <div class="form-row">
                            <div class="form-group col-md-6">
                              <label style="font-size: 16px;">Assigned Type</label>
                              <input type="text" class="input form-control" [value]="viewTask['assignedType']"
                                disabled />
                            </div>
                            <div class="form-group col-md-6">
                              <label style="font-size: 16px;">Assigned To</label>
                              <input type="text" class="input form-control" [value]="viewTask['assignedTo']" disabled />
                            </div>
                          </div>
                          <div class="form-group">
                            <label style="font-size: 16px;">Payload</label>
                            <input type="text" class="input form-control" [value]="viewTask['payload']" disabled />
                          </div>
                          <div class="form-row">
                            <div class="form-group col-md-6">
                              <label style="font-size: 16px;">Created By</label>
                              <input type="text" class="input form-control" [value]="viewTask['createdBy']" disabled />
                            </div>
                            <div class="form-group col-md-">
                              <label style="font-size: 16px;">
                                Last Updated By</label>
                              <input type="text" class="input form-control" [value]="viewTask['updatedBy']" disabled />
                            </div>
                          </div>
                          <div class="form-row">
                            <div class="form-group col-md-6">
                              <label style="font-size: 16px;">Created Time</label>
                              <input type="text" class="input form-control" [value]="viewTask['createdTime'] | date:'medium'"
                                disabled />
                            </div>
                            <div class="form-group col-md-">
                              <label style="font-size: 16px;">Last Updated Time</label>
                              <input type="text" class="input form-control" [value]="viewTask['updatedTime'] | date:'medium'"
                                disabled />
                            </div>
                          </div>
                        </form>
                      </div>
                      <div style="max-width: 500px;">
                        <form>
                          <div class="form-row">
                            <div class="form-group col-md-6">
                              <label style="font-size: 16px;">Task Title</label>
                              <input [(ngModel)]="taskTitleChange" [ngModelOptions]="{ standalone: true }" type="text"
                                class="input form-control" id="lnameInput"
                                [disabled]="updateMode" />
                            </div>
                            <div class="form-group col-md-6">
                              <label>Status</label>
                              <select [(ngModel)]="statusChange" [ngModelOptions]="{ standalone: true }"
                                class="form-control" [disabled]="updateMode">
                                <option [selected]="viewTask['status'] == 'started'">started</option>
                                <option [selected]="
                                    viewTask['status'] == 'in progress'
                                  ">in progress</option>
                                <option [selected]="viewTask['status'] == 'waiting'">waiting</option>
                                <option [selected]="viewTask['status'] == 'completed'">completed</option>
                              </select>
                            </div>
                          </div>
                          <div class="form-group">
                            <label style="font-size: 16px;">Task Description</label>
                            <textarea [(ngModel)]="taskDescriptionChange" [ngModelOptions]="{ standalone: true }"
                              class="form-control" rows="1" id="comment"
                              [disabled]="updateMode"></textarea>
                          </div>
                          <div class="form-group">
                            <label style="font-size: 16px;">Current Owner</label>
                            <input [(ngModel)]="currentOwnerChange" [ngModelOptions]="{ standalone: true }" type="text"
                              class="input form-control" id="fnameInput"
                              [disabled]="updateMode" />
                          </div>
                          <div class="form-group" *ngIf="!updateMode">
                            <label style="font-size: 16px;">Comment</label>
                            <input [(ngModel)]="comment" [ngModelOptions]="{ standalone: true }" type="text"
                              class="input form-control" id="fnameInput" />
                          </div>
                        </form>
                      </div>
                    </div>
                    <div class="table-responsive p-1" *ngIf="taskHistory">
                      <table class="table table-sm m-0">
                        <thead>
                          <tr>
                            <th>Updated By</th>
                            <th>Before Changes</th>
                            <th>After Changes</th>
                            <th>Comment</th>
                            <th>Last Updated Time</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let task of taskHistory">
                            <td>{{ task.updatedBy }}</td>
                            <td><div>Task Title: {{ task.beforeChanges.taskTitle }}</div>
                              <div>Task Description: {{ task.beforeChanges.taskDescription }}</div>
                              <div>Status: {{task.beforeChanges.status}}</div>
                              <div>Current Owner: {{task.beforeChanges.currentOwner}}</div></td>
                              <td><div>Task Title: {{ task.afterChanges.taskTitle }}</div>
                                <div>Task Description: {{ task.afterChanges.taskDescription }}</div>
                                <div>Status: {{task.afterChanges.status}}</div>
                                <div>Current Owner: {{task.afterChanges.currentOwner}}</div></td>
                            <td>{{ task.comment }}</td>
                            <td>{{ task.updatedTime | date:'medium'}}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                  <div *ngIf="updateMessage" style="
                      font-weight: bold;
                      margin-top: 10px;
                      text-align: center;
                      color: #28a745;
                    ">
                    {{ updateMessage }}
                  </div>

                  <div class="modal-footer justify-content-between">
                    <div>
                      <button type="button" class="btn btn-outline-danger" style="border-radius: 20px;"
                        data-dismiss="modal">
                        Close
                      </button>
                      <button type="button" class="btn btn-outline-secondary"
                        style="border-radius: 20px; margin-left: 10px;" (click)="taskHistorybyId(viewTask['_id'])">
                        Task History
                      </button>
                    </div>
                    <div>
                      <button *ngIf="!updateMode" type="button" class="btn btn-outline-success"
                        style="border-radius: 20px; margin-right: 10px;" (click)="updateTaskDetails(viewTask['_id'])">
                        Confirm Update
                      </button>
                      <button type="button" class="btn btn-outline-primary" style="border-radius: 20px;"
                        (click)="switch_update_mode()">
                        Update Task
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="v-pills-profile" role="tabpanel" aria-labelledby="v-pills-profile-tab">
            Reports to be genrated
          </div>
          <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
            <div
              class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
              style="min-height: 72px;">
              <h1 class="h2">Users</h1>
            </div>
            <div class="container-fluid">
              <div class="row row-cols-4">
                <div *ngFor="let user of allusers">
                <div class="col"  style="margin-bottom: 20px;">
                  <div class="card" style="box-shadow:  0px 2px 16px rgba(0, 0, 0, 0.1); border-radius: 10px; width: 240px;">
                    <div class="card-body text-center align-items-center justify-content-center">
                      <div class="imgcontainer" style="border-radius: 50%;">
                        <img class="image" [src]="user.displayPicture" class="card-img-top text-center" alt="..." />
                      </div>
                      <span class="card-title" style="
                          margin-top: 20px;
                          font-weight: bold;
                          display: block;
                          color: #424242;
                        ">{{ user.firstName }} {{ user.lastName }}</span>
                      <div class="card-text">
                          <div style="font-size: smaller;">{{user.username}}</div>
                          <div style="font-size: smaller;">DOB: {{user.dateOfBirth | date}}</div>
                        </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
            <div
              class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
              style="min-height: 72px;">
              <h1 class="h2">Groups</h1>
              <div *ngIf="role=='admin'" class="btn-toolbar mb-2 mb-md-0">
                <button type="button" class="btn btn-outline-secondary btn-1" data-toggle="modal"
                  data-target="#add_roles">
                  Add roles
                </button>
                <button type="button" class="btn btn-outline-secondary btn-1" data-toggle="modal"
                  data-target="#add_groups">
                  New Group
                </button>
              </div>
            </div>
            <div class="container">
            <div class="table-responsive p-3" style="margin: 0 auto; height: auto; width: auto; border:none; box-shadow:  0px 2px 16px rgba(0, 0, 0, 0.1);">
              <table class="table table-sm m-0">
                <thead>
                  <tr>
                    <th>Group Name</th>
                    <th>Group Description</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody *ngIf="role=='admin'">
                  <tr *ngFor="let group of allGroups">
                    <td>{{group.groupName}}</td>
                    <td>{{group.description}}</td>
                    <td><button type="button" class="btn btn-sm btn-secondary"
                      style="border-radius: 20px;" data-toggle="modal" data-target="#view_roles" (click)="getRolesByGroup(group._id)">
                      Members
                    </button></td>
                  </tr>
                </tbody>
                <tbody *ngIf="role=='user'">
                  <tr *ngFor="let group of groups">
                    <td>{{group.groupName}}</td>
                    <td>{{group.description}}</td>
                    <td><button type="button" class="btn btn-sm btn-secondary"
                      style="border-radius: 20px;" data-toggle="modal" data-target="#view_roles" (click)="getRolesByGroup(group._id)">
                      Members
                    </button></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
            <div class="modal fade" id="view_roles" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document" style="max-width: 900px;">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Group Members
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="container-fluid">
                      <div class="row row-cols-4">
                      <div *ngFor="let role of roles">
                        <div *ngFor="let user of allusers">
                        <div class="col" style="margin-bottom: 20px;" *ngIf="role.username==user.username">
                          <div class="card" style="box-shadow:  0px 2px 16px rgba(0, 0, 0, 0.1); border-radius: 10px; width: 180px; height: 240px;">
                            <div class="card-body text-center align-items-center justify-content-center" style="font-size: smaller;">
                              <div class="imgcontainer" style="border-radius: 50%; width:100px; height:100px">
                                <img class="image" [src]="user.displayPicture" class="card-img-top text-center" alt="..." />
                              </div>
                              <span class="card-title" style="
                                  margin-top: 20px;
                                  font-weight: bold;
                                  display: block;
                                  color: #424242;
                                ">{{ user.firstName }} {{ user.lastName }}</span>
                              <div class="card-text">
                                  <div style="font-size: smaller;">{{user.username}}</div>
                                  <div style="font-size: smaller;">DOB: {{user.dateOfBirth | date}}</div>
                                </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <div>
                      <button type="button" class="btn btn-outline-danger" style="border-radius: 20px;"
                        data-dismiss="modal">
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal fade" id="add_groups" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      New Group
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form>
                      <div class="form-group">
                        <input type="text" class="input form-control" placeholder="Group Name" id="lnameInput"
                          (input)="groupTitle = $event.target.value" />
                      </div>
                      <div class="form-group">
                        <textarea class="form-control" rows="4" id="comment" placeholder="Username"
                          (input)="groupDescription = $event.target.value"></textarea>
                      </div>
                      <span *ngIf="groupmessage">
                        {{ groupmessage }}
                      </span>
                    </form>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-danger" style="border-radius: 20px;"
                      data-dismiss="modal">
                      Close
                    </button>
                    <button type="button" class="btn btn-outline-primary" style="border-radius: 20px;"
                      (click)="postGroupDetails()">
                      Create Group
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal fade" id="add_roles" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Add Role
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <form>
                      <div class="form-group">
                        <label>Group Name</label>
                        <select (input)="groupName = $event.target.value"
                          class="form-control" placeholder="Group Name">
                          <option *ngFor="let group of allGroups">{{group.groupName}}</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <textarea class="form-control" rows="4" id="comment" placeholder="Username"
                          (input)="roleUser = $event.target.value"></textarea>
                      </div>
                      <span *ngIf="rolemessage">
                        {{ rolemessage }}
                      </span>
                    </form>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-danger" style="border-radius: 20px;"
                      data-dismiss="modal">
                      Close
                    </button>
                    <button type="button" class="btn btn-outline-primary" style="border-radius: 20px;"
                      (click)="postRoleDetails()">
                      Add Role
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
</div>
